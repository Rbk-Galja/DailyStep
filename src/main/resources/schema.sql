CREATE TABLE IF NOT EXISTS categories (
id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name VARCHAR UNIQUE NOT NULL
);

CREATE TABLE IF NOT EXISTS childrens (
id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
named VARCHAR UNIQUE NOT NULL
);

CREATE TABLE IF NOT EXISTS category_children (
parent_id BIGINT REFERENCES categories(id) ON DELETE CASCADE,
children_id BIGINT REFERENCES childrens(id) ON DELETE CASCADE,
PRIMARY KEY (parent_id, children_id)
);

CREATE TABLE IF NOT EXISTS activity_types (
id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
code VARCHAR UNIQUE NOT NULL,
name VARCHAR NOT NULL,
unit VARCHAR,
icon_name VARCHAR,
activity_category VARCHAR
);

CREATE TABLE IF NOT EXISTS habits (
id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
category_id BIGINT REFERENCES categories(id) ON DELETE SET NULL,
activity_type_id BIGINT REFERENCES activity_types(id) ON DELETE SET NULL,
title VARCHAR NOT NULL,
description VARCHAR,
start TIMESTAMP
);

CREATE TABLE IF NOT EXISTS habit_streaks (
habit_id BIGINT PRIMARY KEY REFERENCES habits(id) ON DELETE CASCADE,
current_streak INT NOT NULL DEFAULT 0,
last_activity_date DATE,
longest_streak INT NOT NULL DEFAULT 0,
updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS activity_records (
id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
habit_id BIGINT REFERENCES habits(id) ON DELETE CASCADE,
start_time TIMESTAMP NOT NULL,
end_time TIMESTAMP NOT NULL,
val BIGINT,
notes VARCHAR
);